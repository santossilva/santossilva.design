<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Between Channels</title>
    <link rel="stylesheet" href="style.css?v=20251215">
</head>
<body>
    <header class="module hero">
        <div class="stack">
            <div class="block">
                <a href="../../index.html" class="w-inline-block" aria-label="Home">
                    <img src="../../images/Vectors-Wrapper.svg" loading="lazy" width="35.800479888916016" height="49.053009033203125" alt="Logo" class="image-2 rgbart-logo">
                </a>
            </div>
            <div class="block">
                <div class="headline-lockup">
                    <div class="headline-group">
                        <h1 class="headline-xxl rgbart-headline">Color perception between the channels.</h1>
                    </div>
                </div>
                <p class="paragraph-l rgbart-description">This project explores how colour is perceived rather than displayed.<br>
                    Each image is composed of separated RGB light channels arranged in discrete patterns. No blended colours are present in the image itself. The perceived colour emerges in the viewer's mind, between the channels, as the visual system integrates the signals into a single experience.</p>
            </div>
        </div>
    </header>

    <section class="module rgbart-filters">
        <div class="block stack">
            <div class="filter-sort-bar">
                <div class="control-group control-group-filter">
                    <div class="control-label">Filter HEX codes</div>
                    <div class="filter-bar" aria-label="Channel filter">
                        <span class="filter-item active" data-value="FF">FF</span>
                        <span class="separator">·</span>
                        <span class="filter-item active" data-value="7D">7D</span>
                        <span class="separator">·</span>
                        <span class="filter-item active" data-value="40">40</span>
                        <span class="separator">·</span>
                        <span class="filter-item active" data-value="20">20</span>
                        <span class="separator">·</span>
                        <span class="filter-item active" data-value="00">00</span>
                    </div>
                </div>

                <div class="control-group control-group-sort">
                    <div class="control-label">Sort by</div>
                    <div class="sort-bar" aria-label="Sort options">
                        <span class="sort-item" data-sort="lum">Luminosity ↑</span>
                        <span class="separator">·</span>
                        <span class="sort-item" data-sort="hue">Hue ↑</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <main class="gallery">
        <div class="grid">
            <div class="item">
                <img src="01 full/000_01-RGBart-FFFFFF-framed-20251214-141743.png" alt="#FFFFFF">
            </div>
            <div class="item">
                <img src="01 full/000_02-RGBart-FFFF00-framed-20251214-141741.png" alt="#FFFF00">
            </div>
            <div class="item">
                <img src="01 full/000_03-RGBart-FF00FF-framed-20251214-141739.png" alt="#FF00FF">
            </div>
            <div class="item">
                <img src="01 full/000_04-RGBart-00FFFF-framed-20251214-141730.png" alt="#00FFFF">
            </div>
            <div class="item">
                <img src="01 full/000_05-RGBart-FF0000-framed-20251214-141737.png" alt="#FF0000">
            </div>
            <div class="item">
                <img src="01 full/000_06-RGBart-00FF00-framed-20251214-141729.png" alt="#00FF00">
            </div>
            <div class="item">
                <img src="01 full/000_07-RGBart-0000FF-framed-20251214-141726.png" alt="#0000FF">
            </div>
            <div class="item">
                <img src="01 full/000_08-RGBart-000000-framed-20251214-141724.png" alt="#000000">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-18/001-RGBart-FFFF7D-framed-20251214-141742.png" alt="#FFFF7D">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-19/002-RGBart-FF7DFF-framed-20251214-141741.png" alt="#FF7DFF">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-20/003-RGBart-7DFFFF-framed-20251214-141737.png" alt="#7DFFFF">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-21/004-RGBart-FF7D7D-framed-20251214-141740.png" alt="#FF7D7D">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-22/005-RGBart-7DFF7D-framed-20251214-141736.png" alt="#7DFF7D">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-23/006-RGBart-7D7DFF-framed-20251214-141734.png" alt="#7D7DFF">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-24/007-RGBart-FF7D40-framed-20251214-142429.png" alt="#FF7D40">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-25/008-RGBart-FF7D00-framed-20251214-141739.png" alt="#FF7D00">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-26/009-RGBart-FF007D-framed-20251214-141738.png" alt="#FF007D">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-27/010-RGBart-7DFF00-framed-20251214-141735.png" alt="#7DFF00">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-28/011-RGBart-7D00FF-framed-20251214-141732.png" alt="#7D00FF">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-29/012-RGBart-00FF7D-framed-20251214-141729.png" alt="#00FF7D">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-30/013-RGBart-007DFF-framed-20251214-141728.png" alt="#007DFF">
            </div>
            <div class="item">
                <img src="02Halvs/2025-12-31/014-RGBart-7D7D7D-framed-20251214-141734.png" alt="#7D7D7D">
            </div>
            <div class="item">
                <img src="02Halvs/2026-01-01/015-RGBart-7D7D00-framed-20251214-141733.png" alt="#7D7D00">
            </div>
            <div class="item">
                <img src="02Halvs/2026-01-02/016-RGBart-7D007D-framed-20251214-141732.png" alt="#7D007D">
            </div>
            <div class="item">
                <img src="02Halvs/2026-01-03/017-RGBart-007D7D-framed-20251214-141727.png" alt="#007D7D">
            </div>
            <div class="item">
                <img src="02Halvs/2026-01-04/018-RGBart-7D0000-framed-20251214-141731.png" alt="#7D0000">
            </div>
            <div class="item">
                <img src="02Halvs/2026-01-05/019-RGBart-007D00-framed-20251214-141727.png" alt="#007D00">
            </div>
            <div class="item">
                <img src="02Halvs/2026-01-06/020-RGBart-00007D-framed-20251214-141725.png" alt="#00007D">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-07/021-RGBart-FFFF40-framed-20251214-142430.png" alt="#FFFF40">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-08/022-RGBart-FF4040-framed-20251214-142429.png" alt="#FF4040">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-09/023-RGBart-40FFFF-framed-20251214-142424.png" alt="#40FFFF">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-10/024-RGBart-7DFF40-framed-20251214-142427.png" alt="#7DFF40">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-11/025-RGBart-40FF7D-framed-20251214-142424.png" alt="#40FF7D">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-12/026-RGBart-407DFF-framed-20251214-142422.png" alt="#407DFF">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-13/027-RGBart-40FF40-framed-20251214-142423.png" alt="#40FF40">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-14/028-RGBart-4040FF-framed-20251214-142419.png" alt="#4040FF">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-15/029-RGBart-FF0040-framed-20251214-142428.png" alt="#FF0040">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-16/030-RGBart-40FF00-framed-20251214-142422.png" alt="#40FF00">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-17/031-RGBart-4000FF-framed-20251214-142416.png" alt="#4000FF">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-18/032-RGBart-00FF40-framed-20251214-142413.png" alt="#00FF40">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-19/033-RGBart-0040FF-framed-20251214-142412.png" alt="#0040FF">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-20/034-RGBart-407D7D-framed-20251214-142421.png" alt="#407D7D">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-21/035-RGBart-7D7D40-framed-20251214-142427.png" alt="#7D7D40">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-22/036-RGBart-407D40-framed-20251214-142420.png" alt="#407D40">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-23/037-RGBart-40407D-framed-20251214-142418.png" alt="#40407D">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-24/038-RGBart-7D4040-framed-20251214-142426.png" alt="#7D4040">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-25/039-RGBart-404040-framed-20251214-142417.png" alt="#404040">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-26/040-RGBart-407D00-framed-20251214-142420.png" alt="#407D00">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-27/041-RGBart-40007D-framed-20251214-142415.png" alt="#40007D">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-28/042-RGBart-7D0040-framed-20251214-142425.png" alt="#7D0040">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-29/043-RGBart-007D40-framed-20251214-142412.png" alt="#007D40">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-30/044-RGBart-00407D-framed-20251214-142411.png" alt="#00407D">
            </div>
            <div class="item">
                <img src="03quarter/2026-01-31/045-RGBart-404000-framed-20251214-142417.png" alt="#404000">
            </div>
            <div class="item">
                <img src="03quarter/2026-02-01/046-RGBart-400040-framed-20251214-142415.png" alt="#400040">
            </div>
            <div class="item">
                <img src="03quarter/2026-02-02/047-RGBart-004040-framed-20251214-142410.png" alt="#004040">
            </div>
            <div class="item">
                <img src="03quarter/2026-02-03/048-RGBart-400000-framed-20251214-142414.png" alt="#400000">
            </div>
            <div class="item">
                <img src="03quarter/2026-02-04/049-RGBart-004000-framed-20251214-142410.png" alt="#004000">
            </div>
            <div class="item">
                <img src="03quarter/2026-02-05/050-RGBart-000040-framed-20251214-142409.png" alt="#000040">
            </div>
            <div class="item">
                <img src="04eights/2026-02-06/051-RGBart-FFFF20-framed-20251214-143810.png" alt="#FFFF20">
            </div>
            <div class="item">
                <img src="04eights/2026-02-07/052-RGBart-FF20FF-framed-20251214-143759.png" alt="#FF20FF">
            </div>
            <div class="item">
                <img src="04eights/2026-02-08/053-RGBart-20FFFF-framed-20251214-143747.png" alt="#20FFFF">
            </div>
            <div class="item">
                <img src="04eights/2026-02-09/054-RGBart-FF7D20-framed-20251214-143807.png" alt="#FF7D20">
            </div>
            <div class="item">
                <img src="04eights/2026-02-10/055-RGBart-7DFF20-framed-20251214-143809.png" alt="#7DFF20">
            </div>
            <div class="item">
                <img src="04eights/2026-02-11/056-RGBart-20FF7D-framed-20251214-143747.png" alt="#20FF7D">
            </div>
            <div class="item">
                <img src="04eights/2026-02-12/057-RGBart-207DFF-framed-20251214-143745.png" alt="#207DFF">
            </div>
            <div class="item">
                <img src="04eights/2026-02-13/058-RGBart-FF4020-framed-20251214-143804.png" alt="#FF4020">
            </div>
            <div class="item">
                <img src="04eights/2026-02-14/059-RGBart-FF2040-framed-20251214-143757.png" alt="#FF2040">
            </div>
            <div class="item">
                <img src="04eights/2026-02-15/060-RGBart-FF207D-framed-20251214-143758.png" alt="#FF207D">
            </div>
            <div class="item">
                <img src="04eights/2026-02-16/061-RGBart-40FF20-framed-20251214-143809.png" alt="#40FF20">
            </div>
            <div class="item">
                <img src="04eights/2026-02-17/062-RGBart-7D4020-framed-20251214-143804.png" alt="#7D4020">
            </div>
            <div class="item">
                <img src="04eights/2026-02-18/063-RGBart-20FF40-framed-20251214-143746.png" alt="#20FF40">
            </div>
            <div class="item">
                <img src="04eights/2026-02-19/064-RGBart-2040FF-framed-20251214-143742.png" alt="#2040FF">
            </div>
            <div class="item">
                <img src="04eights/2026-02-20/065-RGBart-407D20-framed-20251214-143806.png" alt="#407D20">
            </div>
            <div class="item">
                <img src="04eights/2026-02-21/066-RGBart-20FF00-framed-20251214-143745.png" alt="#20FF00">
            </div>
            <div class="item">
                <img src="04eights/2026-02-22/067-RGBart-2000FF-framed-20251214-143739.png" alt="#2000FF">
            </div>
            <div class="item">
                <img src="04eights/2026-02-23/068-RGBart-00FF20-framed-20251214-143808.png" alt="#00FF20">
            </div>
            <div class="item">
                <img src="04eights/2026-02-24/069-RGBart-0020FF-framed-20251214-143750.png" alt="#0020FF">
            </div>
            <div class="item">
                <img src="04eights/2026-02-25/070-RGBart-207D7D-framed-20251214-143744.png" alt="#207D7D">
            </div>
            <div class="item">
                <img src="04eights/2026-02-26/071-RGBart-7D7D20-framed-20251214-143807.png" alt="#7D7D20">
            </div>
            <div class="item">
                <img src="04eights/2026-02-27/072-RGBart-FF2000-framed-20251214-143757.png" alt="#FF2000">
            </div>
            <div class="item">
                <img src="04eights/2026-02-28/073-RGBart-FF0020-framed-20251214-143802.png" alt="#FF0020">
            </div>
            <div class="item">
                <img src="04eights/2026-03-01/074-RGBart-7D2040-framed-20251214-143754.png" alt="#7D2040">
            </div>
            <div class="item">
                <img src="04eights/2026-03-02/075-RGBart-7D207D-framed-20251214-143755.png" alt="#7D207D">
            </div>
            <div class="item">
                <img src="04eights/2026-03-03/076-RGBart-7D20FF-framed-20251214-143756.png" alt="#7D20FF">
            </div>
            <div class="item">
                <img src="04eights/2026-03-04/077-RGBart-404020-framed-20251214-143803.png" alt="#404020">
            </div>
            <div class="item">
                <img src="04eights/2026-03-05/078-RGBart-20407D-framed-20251214-143741.png" alt="#20407D">
            </div>
            <div class="item">
                <img src="04eights/2026-03-06/079-RGBart-204040-framed-20251214-143740.png" alt="#204040">
            </div>
            <div class="item">
                <img src="04eights/2026-03-07/080-RGBart-7D2000-framed-20251214-143754.png" alt="#7D2000">
            </div>
            <div class="item">
                <img src="04eights/2026-03-08/081-RGBart-7D0020-framed-20251214-143801.png" alt="#7D0020">
            </div>
            <div class="item">
                <img src="04eights/2026-03-09/082-RGBart-207D40-framed-20251214-143743.png" alt="#207D40">
            </div>
            <div class="item">
                <img src="04eights/2026-03-10/083-RGBart-20007D-framed-20251214-143738.png" alt="#20007D">
            </div>
            <div class="item">
                <img src="04eights/2026-03-11/084-RGBart-007D20-framed-20251214-143805.png" alt="#007D20">
            </div>
            <div class="item">
                <img src="04eights/2026-03-12/085-RGBart-00207D-framed-20251214-143749.png" alt="#00207D">
            </div>
            <div class="item">
                <img src="04eights/2026-03-13/086-RGBart-207D00-framed-20251214-143742.png" alt="#207D00">
            </div>
            <div class="item">
                <img src="04eights/2026-03-14/087-RGBart-400020-framed-20251214-143800.png" alt="#400020">
            </div>
            <div class="item">
                <img src="04eights/2026-03-15/088-RGBart-204000-framed-20251214-143739.png" alt="#204000">
            </div>
            <div class="item">
                <img src="04eights/2026-03-16/089-RGBart-402040-framed-20251214-143752.png" alt="#402040">
            </div>
            <div class="item">
                <img src="04eights/2026-03-17/090-RGBart-40207D-framed-20251214-143752.png" alt="#40207D">
            </div>
            <div class="item">
                <img src="04eights/2026-03-18/091-RGBart-4020FF-framed-20251214-143753.png" alt="#4020FF">
            </div>
            <div class="item">
                <img src="04eights/2026-03-19/092-RGBart-004020-framed-20251214-143802.png" alt="#004020">
            </div>
            <div class="item">
                <img src="04eights/2026-03-20/093-RGBart-200040-framed-20251214-143737.png" alt="#200040">
            </div>
            <div class="item">
                <img src="04eights/2026-03-20/093-RGBart-402000-framed-20251214-143751.png" alt="#402000">
            </div>
            <div class="item">
                <img src="04eights/2026-03-21/094-RGBart-002040-framed-20251214-143749.png" alt="#002040">
            </div>
            <div class="item">
                <img src="04eights/2026-03-21/094-RGBart-202020-framed-20251214-143811.png" alt="#202020">
            </div>
            <div class="item">
                <img src="04eights/2026-03-22/095-RGBart-200000-framed-20251214-143737.png" alt="#200000">
            </div>
            <div class="item">
                <img src="04eights/2026-03-23/096-RGBart-002000-framed-20251214-143748.png" alt="#002000">
            </div>
            <div class="item">
                <img src="04eights/2026-03-24/097-RGBart-000020-framed-20251214-143759.png" alt="#000020">
            </div>
        </div>
    </main>

    <footer class="module rgbart-footer">
        <div class="stack">
            <div class="block">
                <a href="../../index.html" class="w-inline-block" aria-label="Home">
                    <img src="../../images/Vectors-Wrapper.svg" loading="lazy" width="35.800479888916016" height="49.053009033203125" alt="Logo" class="image-2 rgbart-logo">
                </a>
            </div>
           
        </div>
    </footer>
    
    <div id="fullscreen-overlay" class="fullscreen-overlay">
        <div class="nav-arrow nav-left">‹</div>
        <img id="fullscreen-image" src="" alt="">
        <div class="nav-arrow nav-right">›</div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const filterItems = document.querySelectorAll('.filter-item');
            const sortItems = document.querySelectorAll('.sort-item');
            const grid = document.querySelector('.grid');
            const overlay = document.getElementById('fullscreen-overlay');
            const fullscreenImg = document.getElementById('fullscreen-image');
            const navLeft = document.querySelector('.nav-left');
            const navRight = document.querySelector('.nav-right');
            let currentIndex = 0;
            let visibleItems = [];
            let currentSort = 'hue_down';
            let lastSwipeAt = 0;

            function getItemsInDomOrder() {
                return Array.from(grid.querySelectorAll('.item'));
            }

            function getSortData(item) {
                if (item._rgbartSort) return item._rgbartSort;

                const img = item.querySelector('img');
                const hex = img.alt.replace('#', '').toUpperCase();

                const r8 = parseInt(hex.substring(0, 2), 16);
                const g8 = parseInt(hex.substring(2, 4), 16);
                const b8 = parseInt(hex.substring(4, 6), 16);

                const r = r8 / 255;
                const g = g8 / 255;
                const b = b8 / 255;

                const max = Math.max(r, g, b);
                const min = Math.min(r, g, b);
                const delta = max - min;

                let hue = 0;
                if (delta !== 0) {
                    if (max === r) hue = ((g - b) / delta) % 6;
                    else if (max === g) hue = (b - r) / delta + 2;
                    else hue = (r - g) / delta + 4;
                    hue *= 60;
                    if (hue < 0) hue += 360;
                }

                const saturation = max === 0 ? 0 : delta / max;
                const isGray = saturation < 0.02 || delta < 1e-10;

                function linearize(v) {
                    return v <= 0.04045 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
                }

                const rLin = linearize(r);
                const gLin = linearize(g);
                const bLin = linearize(b);
                const luminance = 0.2126 * rLin + 0.7152 * gLin + 0.0722 * bLin;

                item._rgbartSort = { hue, saturation, luminance, isGray };
                return item._rgbartSort;
            }
            
            // Filter functionality
            filterItems.forEach(filter => {
                filter.addEventListener('click', function() {
                    this.classList.toggle('active');
                    applyFilters();
                });
            });
            
            function applyFilters() {
                const activeValues = Array.from(document.querySelectorAll('.filter-item.active'))
                    .map(f => f.dataset.value);
                
                getItemsInDomOrder().forEach(item => {
                    const img = item.querySelector('img');
                    const hex = img.alt.replace('#', '').toUpperCase();
                    
                    // Extract RGB pairs
                    const r = hex.substring(0, 2);
                    const g = hex.substring(2, 4);
                    const b = hex.substring(4, 6);
                    
                    // Check if all RGB values are in active filters
                    const rMatch = activeValues.includes(r);
                    const gMatch = activeValues.includes(g);
                    const bMatch = activeValues.includes(b);
                    
                    if (rMatch && gMatch && bMatch) {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });
                
                updateVisibleItems();
            }

            function setActiveSort(nextSort) {
                currentSort = nextSort;
                sortItems.forEach(el => el.classList.remove('active'));
                updateSortUi();
            }

            function updateSortUi() {
                sortItems.forEach(el => {
                    const kind = el.dataset.sort;

                    if (kind === 'lum') {
                        const active = currentSort.startsWith('lum_');
                        const arrow = active ? (currentSort === 'lum_down' ? '↓' : '↑') : '↑';
                        el.classList.toggle('active', active);
                        el.textContent = `Luminosity ${arrow}`;
                        return;
                    }

                    if (kind === 'hue') {
                        const active = currentSort.startsWith('hue_');
                        const arrow = active ? (currentSort === 'hue_down' ? '↓' : '↑') : '↑';
                        el.classList.toggle('active', active);
                        el.textContent = `Hue ${arrow}`;
                    }
                });
            }

            function toggleSort(kind) {
                if (kind === 'lum') {
                    if (!currentSort.startsWith('lum_')) return 'lum_up';
                    return currentSort === 'lum_up' ? 'lum_down' : 'lum_up';
                }

                if (kind === 'hue') {
                    if (!currentSort.startsWith('hue_')) return 'hue_up';
                    return currentSort === 'hue_up' ? 'hue_down' : 'hue_up';
                }

                return 'original';
            }

            function applySort() {
                const items = getItemsInDomOrder();
                const direction = currentSort.endsWith('_down') ? -1 : 1;

                const sorted = items.slice().sort((a, b) => {
                    const aOriginal = Number(a.dataset.originalIndex || 0);
                    const bOriginal = Number(b.dataset.originalIndex || 0);

                    if (currentSort === 'original') return aOriginal - bOriginal;

                    const aData = getSortData(a);
                    const bData = getSortData(b);

                    if (currentSort.startsWith('hue_')) {
                        if (aData.isGray !== bData.isGray) return aData.isGray ? 1 : -1;

                        if (aData.isGray && bData.isGray) {
                            if (aData.luminance !== bData.luminance) return direction * (aData.luminance - bData.luminance);
                            return aOriginal - bOriginal;
                        }

                        if (aData.hue !== bData.hue) return direction * (aData.hue - bData.hue);
                        if (aData.saturation !== bData.saturation) return bData.saturation - aData.saturation;
                        if (aData.luminance !== bData.luminance) return aData.luminance - bData.luminance;
                        return aOriginal - bOriginal;
                    }

                    if (currentSort.startsWith('lum_')) {
                        if (aData.luminance !== bData.luminance) return direction * (aData.luminance - bData.luminance);
                        if (aData.hue !== bData.hue) return aData.hue - bData.hue;
                        if (aData.saturation !== bData.saturation) return bData.saturation - aData.saturation;
                        return aOriginal - bOriginal;
                    }

                    return aOriginal - bOriginal;
                });

                const fragment = document.createDocumentFragment();
                sorted.forEach(item => fragment.appendChild(item));
                grid.appendChild(fragment);

                updateVisibleItems();
            }
            
            function updateVisibleItems() {
                visibleItems = getItemsInDomOrder().filter(item => item.style.display !== 'none');
            }
            
            function showImage(index) {
                if (visibleItems.length === 0) return;
                
                currentIndex = index;
                if (currentIndex < 0) currentIndex = visibleItems.length - 1;
                if (currentIndex >= visibleItems.length) currentIndex = 0;
                
                const img = visibleItems[currentIndex].querySelector('img');
                fullscreenImg.src = img.src;
                fullscreenImg.alt = img.alt;
            }
            
            function navigateNext() {
                showImage(currentIndex + 1);
            }
            
            function navigatePrev() {
                showImage(currentIndex - 1);
            }

            function openOverlay() {
                overlay.classList.add('active');
                document.documentElement.classList.add('no-scroll');
                document.body.classList.add('no-scroll');
            }

            function closeOverlay() {
                overlay.classList.remove('active');
                document.documentElement.classList.remove('no-scroll');
                document.body.classList.remove('no-scroll');
            }
            
            // Fullscreen functionality
            getItemsInDomOrder().forEach((item, index) => {
                item.dataset.originalIndex = String(index);
            });

            updateVisibleItems();
            
            getItemsInDomOrder().forEach((item) => {
                const img = item.querySelector('img');
                img.addEventListener('click', function() {
                    updateVisibleItems();
                    currentIndex = visibleItems.indexOf(item);
                    showImage(currentIndex);
                    openOverlay();
                });
            });

            sortItems.forEach(el => {
                el.addEventListener('click', function() {
                    setActiveSort(toggleSort(this.dataset.sort));
                    applySort();
                });
            });

            updateSortUi();
            applySort();
            
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    closeOverlay();
                }
            });

            fullscreenImg.addEventListener('click', function(e) {
                e.stopPropagation();
                if (Date.now() - lastSwipeAt < 400) return;
                closeOverlay();
            });

            navLeft.addEventListener('click', function(e) {
                e.stopPropagation();
                navigatePrev();
            });
            
            navRight.addEventListener('click', function(e) {
                e.stopPropagation();
                navigateNext();
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (!overlay.classList.contains('active')) return;
                
                if (e.key === 'ArrowLeft') {
                    navigatePrev();
                } else if (e.key === 'ArrowRight') {
                    navigateNext();
                } else if (e.key === 'Escape') {
                    closeOverlay();
                }
            });

            // Swipe (vertical) navigation inside lightbox (mobile-friendly)
            const swipeThresholdPx = 50;
            let gestureStartX = 0;
            let gestureStartY = 0;
            let gestureActive = false;
            let gesturePointerId = null;

            function onGestureStart(x, y) {
                gestureStartX = x;
                gestureStartY = y;
                gestureActive = true;
            }

            function onGestureEnd(x, y) {
                if (!gestureActive) return;
                gestureActive = false;

                const dx = x - gestureStartX;
                const dy = y - gestureStartY;
                const absX = Math.abs(dx);
                const absY = Math.abs(dy);
                if (absY < swipeThresholdPx || absY < absX) return;

                lastSwipeAt = Date.now();
                if (dy < 0) navigateNext();
                else navigatePrev();
            }

            overlay.addEventListener('pointerdown', function(e) {
                if (!overlay.classList.contains('active')) return;
                if (e.pointerType === 'mouse') return;
                gesturePointerId = e.pointerId;
                onGestureStart(e.clientX, e.clientY);
                try {
                    overlay.setPointerCapture(e.pointerId);
                } catch (_) {}
            });

            overlay.addEventListener('pointerup', function(e) {
                if (!overlay.classList.contains('active')) return;
                if (e.pointerType === 'mouse') return;
                if (gesturePointerId !== null && e.pointerId !== gesturePointerId) return;
                gesturePointerId = null;
                onGestureEnd(e.clientX, e.clientY);
            });

            overlay.addEventListener('pointercancel', function(e) {
                if (gesturePointerId !== null && e.pointerId !== gesturePointerId) return;
                gesturePointerId = null;
                gestureActive = false;
            });

            // Fallback for browsers without Pointer Events
            overlay.addEventListener('touchstart', function(e) {
                if (!overlay.classList.contains('active')) return;
                if (e.touches.length !== 1) return;
                onGestureStart(e.touches[0].clientX, e.touches[0].clientY);
            }, { passive: true });

            overlay.addEventListener('touchend', function(e) {
                if (!overlay.classList.contains('active')) return;
                if (e.changedTouches.length !== 1) return;
                onGestureEnd(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
            }, { passive: true });
        });
    </script>
</body>
</html>
